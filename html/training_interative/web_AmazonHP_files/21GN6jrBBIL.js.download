'use strict';mix_d("MagpollRatingsWidgetCards__this-or-that-card:this-or-that-card__MKCnvOyu","exports tslib @c/browser-operations @c/logger @c/remote-operations @c/scoped-dom @c/aui-utils @c/tracking".split(" "),function(y,z,B,C,D,E,F,G){function p(c){return c&&"object"===typeof c&&"default"in c?c:{"default":c}}var H=p(B),q=p(C),I=p(D),l=p(E),A=p(F),J=function(){function c(e){this._htmlElement=e&&l["default"].scopeElement(e);this._hasFeedback=!1}Object.defineProperty(c.prototype,"hasFeedback",{get:function(){return this._hasFeedback},
set:function(e){this._hasFeedback=e},enumerable:!1,configurable:!0});c.prototype.updateHeaderAndButton=function(){var e,f,g,h=null===(e=this._htmlElement)||void 0===e?void 0:e.root.querySelector("._this-or-that-card_style_card-prompt__3USOf");e=null===(f=this._htmlElement)||void 0===f?void 0:f.root.querySelector("._this-or-that-card_style_card-prompt-without-feedback__3XeKA");f=null===(g=this._htmlElement)||void 0===g?void 0:g.root.querySelector("._this-or-that-card_style_playback-button__EPN0U");
this._hasFeedback&&(null===h||void 0===h?void 0:h.classList.remove("aok-hidden"),null===e||void 0===e?void 0:e.classList.add("aok-hidden"),f&&(f.style.visibility="visible"))};return c}(),k;(function(c){c.RESIZE="resize";c.LEFT_SWIPE="leftSwipe";c.RIGHT_SWIPE="rightSwipe";c.DOWN_SWIPE="downSwipe"})(k||(k={}));var n=function(c,e){if(!c.closest){a:{do{var f=c;var g=e;if(f.matches)f=f.matches(g);else if(f.msMatchesSelector)f=f.msMatchesSelector(g);else if(f.webkitMatchesSelector)f=f.webkitMatchesSelector(g);
else throw Error("Browser is likely too old and doesn't support 'matches' function.");if(f){e=c;break a}c=c.parentElement||c.parentNode}while(null!==c&&1===c.nodeType);e=null}return e}return c.closest(e)},r=function(c,e){var f,g=n(c,"._this-or-that-card_style_card-container__z099o");g?(g.classList.add("_this-or-that-card_style_rated__1KnWL",e),setTimeout(function(){if(g.remove)g.remove();else{var m=g.parentNode;m&&m.removeChild(g)}},280)):q["default"].log("Failed to find the closest '._this-or-that-card_style_card-container__z099o' relative to the clicked button.",
"ERROR");if(g&&g.dataset.cardIndex){e=parseInt(l["default"].cardRoot.dataset.totalRatableCards,10);if(1===e){var h=l["default"].cardRoot.querySelector("._this-or-that-card_style_playback-button__EPN0U a");c=n(c,"._this-or-that-card_style_this-or-that-vote-button-container__Wn0nd");h&&(h.href=null!==(f=null===c||void 0===c?void 0:c.dataset.dpUrl)&&void 0!==f?f:h.href)}f=(parseInt(g.dataset.cardIndex,10)+1)/e*100;if(c=l["default"].cardRoot.querySelector("._this-or-that-card_style_progress-indicator__2GBSQ"))c.style.width=
f+"%"}};y._operationNames=["publishFeedback"];y.card=function(){return z.__awaiter(void 0,void 0,void 0,function(){var c,e,f,g,h,m,t,u,v;return z.__generator(this,function(K){c=H["default"].setup().define;e=I["default"].setup();f=l["default"].cardRoot.querySelector("._this-or-that-card_style_terminal-v2-card__3ebVi");g=new J(f);h=parseInt(l["default"].cardRoot.dataset.swipeTimeout,0);m=function(a){var b;a=n(a,"._this-or-that-card_style_this-or-that-feedback-container__-Pxgp");var d=null!==(b=null===
a||void 0===a?void 0:a.dataset)&&void 0!==b?b:{};b=d.decision;a=d.feedbackToken;d=d.asin;d=G.addTracking(e.publishFeedback,d?{pd_rd_i:d}:void 0,b?"_tot_"+b:void 0);return b&&a?(g.hasFeedback=g.hasFeedback||"no-decision-selected"!==b,d({decision:b,feedbackToken:a})):Promise.reject(Error("Failed to find feedbackToken or decision in the DOM."))};t=function(a){a=n(a,"._this-or-that-card_style_card-container__z099o");a=null===a||void 0===a?void 0:a.querySelector("._this-or-that-card_style_current-status-bar__3radf");
null===a||void 0===a?void 0:a.classList.add("_this-or-that-card_style_animate-segmented-status-bar__3jPhk")};u=function(a){a=n(a,"._this-or-that-card_style_card-container__z099o");var b=null===a||void 0===a?void 0:a.querySelector("._this-or-that-card_style_this-or-that-vote-percentage-bar-container__tefb0");if(b){var d=null===a||void 0===a?void 0:a.querySelector("._this-or-that-card_style_this-or-that-vote-container__2Jcn1");null===d||void 0===d?void 0:d.classList.add("aok-hidden");d=null===a||void 0===
a?void 0:a.querySelector("._this-or-that-card_style_this-or-that-neither-link-container-mobile__QkmNS");null===d||void 0===d?void 0:d.classList.add("_this-or-that-card_style_hide-third-option__2bILs");d=null===a||void 0===a?void 0:a.querySelector("._this-or-that-card_style_this-or-that-neither-link-container-desktop__20-iz");null===d||void 0===d?void 0:d.classList.add("_this-or-that-card_style_hide-third-option__2bILs")}null===b||void 0===b?void 0:b.classList.remove("aok-hidden");b=null===a||void 0===
a?void 0:a.querySelector("._this-or-that-card_style_this-percentage-bar__Pa-1c");if(null===b||void 0===b?0:b.offsetWidth)null===b||void 0===b?void 0:b.classList.add("_this-or-that-card_style_animate-percentage-bar__2nF9W");a=null===a||void 0===a?void 0:a.querySelector("._this-or-that-card_style_that-percentage-bar__3CkUE");if(null===a||void 0===a?0:a.offsetWidth)null===a||void 0===a?void 0:a.classList.add("_this-or-that-card_style_animate-percentage-bar__2nF9W")};v=function(a,b){a=n(a,"._this-or-that-card_style_card-container__z099o");
if(b===k.LEFT_SWIPE)b="._this-or-that-card_style_this-asin-choice__8uIre";else if(b===k.RIGHT_SWIPE)b="._this-or-that-card_style_that-asin-choice__3u2Ea";else return;b=null===a||void 0===a?void 0:a.querySelector(b);null===b||void 0===b?void 0:b.classList.remove("aok-hidden")};c(k.RESIZE,"resize",function(a){a=l["default"].cardRoot.getElementsByClassName("_this-or-that-card_style_this-or-that-image-container__1tYeZ");for(var b=0;b<a.length;b++){var d=a[b];d.style.width="";d.style.height="";var w=d.offsetWidth,
x=d.offsetHeight;.5>w/x?d.style.height=w/.5+"px":1<w/x&&(d.style.width=1*x+"px")}});c(k.LEFT_SWIPE,["click","touchend"],function(a){var b=a.target;b&&(m(b).catch(function(d){return q["default"].log(d,"WARN")}),t(b),u(b),v(b,k.LEFT_SWIPE),g.updateHeaderAndButton(),A["default"].delay(function(){r(b,"_this-or-that-card_style_left-swipe__O35cS")},h))});c(k.RIGHT_SWIPE,["click","touchend"],function(a){var b=a.target;b&&(m(b).catch(function(d){return q["default"].log(d,"WARN")}),t(b),u(b),v(b,k.RIGHT_SWIPE),
g.updateHeaderAndButton(),A["default"].delay(function(){r(b,"_this-or-that-card_style_right-swipe__1MmVr")},h))});c(k.DOWN_SWIPE,["click","touchend"],function(a){if(a=a.target)m(a).catch(function(b){return q["default"].log(b,"WARN")}),g.updateHeaderAndButton(),r(a,"_this-or-that-card_style_down-swipe__2p4Cn")});return[2]})})}});
